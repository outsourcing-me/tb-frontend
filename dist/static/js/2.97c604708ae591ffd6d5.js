webpackJsonp([2],{"1DeE":function(t,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=n("Dd8w"),e=n.n(i),s=n("Xxa5"),o=n.n(s),c=n("//Fk"),r=n.n(c),l=n("exGp"),u=n.n(l),d=n("M4fF"),m=(n.n(d),n("bgEm")),p=n("NYxO"),f=n("3dbI");a.default={countdownHandle:null,dataHandle:null,bonusHandle:null,audioPushCoin:null,audioFillBullet:null,beforeRouteEnter:function(t,a,n){var i=this;return u()(o.a.mark(function a(){var e;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,r.a.all([f.b.save({roomid:t.params.id}).then(function(t){return t.json()}),f.c.save({roomid:t.params.id}).then(function(t){return t.json()})]);case 2:e=a.sent,n(function(t){t.price=Number(e[0].data.price),t.barrageList=e[1].data.chat,t.playerList=e[1].data.list});case 4:case"end":return a.stop()}},a,i)}))()},beforeRouteLeave:function(t,a,n){this.loopDataStop(),this.countdownStop(),n()},mounted:function(){this.loopDataBegin(),this.audioPushCoin=new Audio(n("olfr")),this.audioFillBullet=new Audio(n("rQQM")),this.audioFillBullet.loop=!1,this.audioPushCoin.loop=!1},beforeDesdroy:function(){this.countdownStop()},methods:e()({},n.i(p.c)(["updateUserAssets"]),n.i(p.a)(["updateSoundSwitch"]),{back:function(){var t=this;if("watching"===this.status)return void this.$router.push({name:"index"});n.i(m.a)({message:this.$t("common.game.exitMessage")}).$on("msgbox-close",function(a){"confirm"===a&&t.$routerBack()})},beginPlay:function(){var t=this;return u()(o.a.mark(function a(){return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.noCoinsTip();case 2:t.status="playing",t.$nextTick(function(){t.countdownStart(),t.loadBullet()});case 4:case"end":return a.stop()}},a,t)}))()},endPlay:function(){this.status="watching",this.countdownStop(),this.$toast(this.$t("common.game.gameOver"))},updatePlayer:function(){return f.c.save({_showLoadingStatus:!1},{roomid:this.$route.params.id}).then(function(t){return t.json()})},loopDataStop:function(){clearInterval(this.dataHandle)},loopDataBegin:function(){var t=this;this.loopDataStop(),this.updatePlayer().then(function(a){t.playerList=a.data.list,t.barrageList=a.data.chat,t.dataHandle=setTimeout(function(){console.log("data loop running"),t.loopDataBegin()},3e4)})},playAudio:function(t){this.soundOn&&this[t]&&(console.log(this[t]),this[t].play())},pushCoin:function(){this.currentBulletCount>0?(this.currentBulletCount-=1,this.playAudio("audioPushCoin"),this.countdownStart()):this.loadBullet()},toggleSound:function(t){console.log(t),this.updateSoundSwitch(t)},submit:function(){var t=this;return u()(o.a.mark(function a(){var n;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,f.d.save({roomid:t.$route.params.id,content:t.message}).then(function(t){return t.json()});case 2:n=a.sent,t.barrageList=n.data.list,t.messageInputVisible=!1;case 5:case"end":return a.stop()}},a,t)}))()},showWinTip:function(){var t=this;this.winTipShow=!0,this.updateUserAssets(this.user.assets+this.winTipNum.number),setTimeout(function(){t.winTipShow=!1},1e3)},countdownStart:function(){var t=this;this.countdownStop(),this.countdown={number:30,geWei:0,shiWei:3},this.countdownHandle=setInterval(function(){if(console.log("countdown running",t.countdown),t.countdown.number>0){t.countdown.number-=1;var a=t.countdown.number.toString().split("");t.countdown.shiWei=a[0],t.countdown.geWei=a[1]}else t.endPlay()},1e3)},countdownStop:function(){clearInterval(this.countdownHandle)},showBonusRandom:function(){this.showBonus(["bonusTime","coin","cool","tripleCoin"][4*Math.random()|0]),console.log(this.bonusTarget)},showBonus:function(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";clearTimeout(this.bonusHandle),this.bonusTarget=a,this.bonusHandle=setTimeout(function(){t.bonusTarget=""},1500)},showWinDialog:function(){var t=this;n.i(m.a)({title:'<div class="button Ribbon_con"></div>',message:'\n          <div class="button win"></div>\n          <div>\n            <div class="icon Coin_icon mr5"></div>\n            <div class="icon number mrr5 '+(this.winTipNum.shiWei?"n"+this.winTipNum.shiWei:"")+'"></div>\n            <div class="icon number '+(this.winTipNum.geWei?"n"+this.winTipNum.geWei:"dn")+'"></div>\n          </div>\n        '}).$on("msgbox-close",function(a){t.showWinTip()})},noCoinsTip:function(){var t=this;return new r.a(function(a,i){t.user.assets<t.price?n.i(m.a)({message:'\n          <div class="button nothing"></div>\n          <div>\n            '+t.$t("common.game.noCoins")+"\n          </div>\n        "}).$on("msgbox-close",function(t){i(t)}):a()})},loadBullet:function(){var t=this;return u()(o.a.mark(function a(){return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!t.animateCoins&&!t.currentBulletCount){a.next=3;break}return t.$toast(t.$t("common.game.loadingBullet")),a.abrupt("return");case 3:return a.next=5,t.noCoinsTip().catch(function(a){throw t.endPlay(),new Error("no coins")});case 5:if(!(t.user.assets<t.price)){a.next=8;break}return n.i(m.a)({message:'\n          <div class="button nothing"></div>\n          <div>\n            '+t.$t("common.game.noCoins")+"\n          </div>\n        "}).$on("msgbox-close",function(a){console.log("endPlay"),t.endPlay()}),a.abrupt("return");case 8:t.maxBullet=Math.min(6,t.user.assets/t.price|0),console.log(t.maxBullet,"max bullet"),t.animateCoins=!0,t.playAudio("audioFillBullet"),n.i(d.each)([0,1,2,3,4,5],function(a){setTimeout(function(){t.user.assets>=t.price&&(t.currentBulletCount+=1,t.updateUserAssets(t.user.assets-t.price))},100*a+300)}),setTimeout(function(){t.animateCoins=!1},1e3);case 14:case"end":return a.stop()}},a,t)}))()},showMessageInput:function(){var t=this;this.messageInputVisible=!0,this.$nextTick(function(){t.$refs.messageInput.focus()})}}),computed:e()({},n.i(p.b)(["user","soundSwitch"]),{soundOn:function(){return"on"===this.soundSwitch}}),data:function(){return{avatarSpare:n("j8KV"),price:0,currentBulletCount:0,maxBullet:6,barrageList:[],playerList:[],bonusTarget:"",countdown:{number:30,geWei:1,shiWei:1},winTipNum:{number:11,geWei:1,shiWei:1},winTipTranstion:"slideDownFade",winTipShow:!1,messageInputVisible:!1,animateCoins:!1,message:"",status:"watching",expand:!1}}}},"72Dr":function(t,a,n){a=t.exports=n("FZ+f")(),a.push([t.i,".demo[data-v-644a9f2c]{width:100%}.hidden[data-v-644a9f2c]{visibility:hidden}.slideDownFade-leave-active[data-v-644a9f2c]{position:absolute}.animate-coins.animate .coin1[data-v-644a9f2c]{animation-name:rotateFadeDown1;animation-timing-function:ease-in;animation-duration:.5s;animation-delay:0s;animation-iteration-count:1}.animate-coins.animate .coin2[data-v-644a9f2c]{animation-name:rotateFadeDown2;animation-timing-function:ease-in;animation-duration:.5s;animation-delay:.1s;animation-iteration-count:1}.animate-coins.animate .coin3[data-v-644a9f2c]{animation-name:rotateFadeDown3;animation-timing-function:ease-in;animation-duration:.5s;animation-delay:.2s;animation-iteration-count:1}.animate-coins.animate .coin4[data-v-644a9f2c]{animation-name:rotateFadeDown4;animation-timing-function:ease-in;animation-duration:.5s;animation-delay:.3s;animation-iteration-count:1}.animate-coins.animate .coin5[data-v-644a9f2c]{animation-name:rotateFadeDown5;animation-timing-function:ease-in;animation-duration:.5s;animation-delay:.4s;animation-iteration-count:1}.animate-coins.animate .coin6[data-v-644a9f2c]{animation-name:rotateFadeDown6;animation-timing-function:ease-in;animation-duration:.5s;animation-delay:.5s;animation-iteration-count:1}.ic_start_game_Coin_con[data-v-644a9f2c]{transition:background .5s}.handle[data-v-644a9f2c]{display:-ms-flexbox;display:flex;padding-left:12px;margin-right:8px;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;color:#fff}.footer[data-v-644a9f2c]{height:106px}.play-status[data-v-644a9f2c]{line-height:22px;color:#fff}.play-status .ic_status_icon span[data-v-644a9f2c]{display:inline-block;padding-left:5px;font-size:12px;-ms-transform:scale(.8333);transform:scale(.8333)}.fixed-message[data-v-644a9f2c]{position:fixed;z-index:999;bottom:5px;left:0;right:0}.fixed-message form[data-v-644a9f2c]{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}.fixed-message .message-input[data-v-644a9f2c]{-ms-flex:1;flex:1;padding:0 10px}.fixed-message input[data-v-644a9f2c]{-webkit-appearance:none;border:0;border-bottom:1px solid #ffa42f;height:30px;width:100%}.fixed-message button[data-v-644a9f2c]{width:4em;text-align:center}.fixed-message button[data-v-644a9f2c]:active{color:#ffa42f}.live-container[data-v-644a9f2c]{position:relative}.bonus-mask[data-v-644a9f2c]{position:absolute;top:0;left:0;right:0;bottom:0}.bonus-mask .button[data-v-644a9f2c]{top:50%;left:50%;-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);position:absolute;opacity:0}.bonus-mask .button.animate[data-v-644a9f2c]{animation-name:scaleFadeIn;animation-timing-function:ease-in;animation-duration:2s;animation-iteration-count:1}.ic_start_game_bg[data-v-644a9f2c]{font-size:30px;color:#fff;line-height:60px;text-align:center}.ic_game_Message[data-v-644a9f2c]{margin-left:8px}.clock[data-v-644a9f2c]{position:absolute;left:10px;top:74px;z-index:1000}.Coin_icon[data-v-644a9f2c]{position:absolute;left:5px;top:2px}.ic_start_game_my[data-v-644a9f2c]{color:#fff}.ic_start_game_my span[data-v-644a9f2c]{display:inline-block;width:50px;text-align:center;margin:10px 0 0 44px}.coins[data-v-644a9f2c]{position:absolute;top:15px;left:50%;z-index:1000;-ms-transform:translateX(-50%);transform:translateX(-50%)}.coins .tips[data-v-644a9f2c]{position:absolute;left:0;right:0;top:-10px}.countdown[data-v-644a9f2c]{padding:17px 0 0 26px;text-align:center}.players[data-v-644a9f2c]{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;z-index:1000;position:absolute;right:0;top:10px;width:180px;transition:transform .3s;-ms-transform:translateX(132px);transform:translateX(132px)}.players.playing[data-v-644a9f2c]{top:80px}.players.expand[data-v-644a9f2c]{-ms-transform:translateX(0);transform:translateX(0)}.player-queue[data-v-644a9f2c]{height:44px;display:-ms-flexbox;display:flex;-ms-flex-pack:start;justify-content:flex-start;-ms-flex-align:center;align-items:center;border-radius:100px 0 0 100px;background-color:rgba(0,0,0,.5)}.barrage-list[data-v-644a9f2c]{margin-top:18px;-ms-flex-direction:column;flex-direction:column;max-height:30vh;overflow-y:scroll;-ms-touch-action:pan-y;touch-action:pan-y;-webkit-overflow-scrolling:touch}.barrage-item[data-v-644a9f2c]{transition:all .3s;margin-bottom:3px;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;padding:2px 5px 2px 2px;background-color:rgba(0,0,0,.5);border-radius:100px;float:left;font-size:12px;color:#fff;clear:both}.barrage-content[data-v-644a9f2c]{-ms-flex:1;flex:1;overflow:hidden;max-width:160px;text-overflow:ellipsis}.avatar-sm[data-v-644a9f2c]{border-radius:50%;height:18px;width:18px;margin-right:6px;overflow:hidden}.avatar-sm img[data-v-644a9f2c]{width:100%;height:100%}.avatar[data-v-644a9f2c]{margin-left:4px;border-radius:50%;height:36px;width:36px;overflow:hidden}.avatar img[data-v-644a9f2c]{width:100%;height:100%}",""])},EmNY:function(t,a,n){n("jP+7"),n("ZEsP");var i=n("VU/8")(n("1DeE"),n("lKED"),"data-v-644a9f2c",null);t.exports=i.exports},ZEsP:function(t,a,n){var i=n("72Dr");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);n("rjj0")("785cc6c6",i,!0)},j8KV:function(t,a,n){t.exports=n.p+"static/img/icon_user.094a542.png"},"jP+7":function(t,a,n){var i=n("kiRh");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);n("rjj0")("8d92e55e",i,!0)},kiRh:function(t,a,n){a=t.exports=n("FZ+f")(),a.push([t.i,".room-header.watching{pointer-events:none}.room-header.watching .left,.room-header.watching .mid,.room-header.watching .right{pointer-events:auto}",""])},lKED:function(t,a,n){t.exports={render:function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("section",{staticClass:"game"},[i("tb-header",{ref:"header",staticClass:"room-header",class:t.status,attrs:{fixed:!0}},[i("div",{staticClass:"icon ic_title_menu_Up_tn mlr10 mt15",attrs:{slot:"left"},on:{click:function(a){t.back()}},slot:"left"}),"playing"===t.status?i("div",{staticClass:"flex mrr10 mt15",attrs:{slot:"right"},slot:"right"},["off"===t.soundSwitch?i("div",{staticClass:"icon ic_title_Sound_off",on:{click:function(a){t.toggleSound("on")}}}):i("div",{staticClass:"icon ic_title_Sound_on",on:{click:function(a){t.toggleSound("off")}}})]):t._e()]),i("div",{ref:"body",staticClass:"body overflow-scroll"},[i("div",{directives:[{name:"show",rawName:"v-show",value:"playing"===t.status,expression:"status === 'playing'"}],staticClass:"coins"},[i("transition",{attrs:{name:t.winTipTranstion}},[t.winTipShow?i("div",{staticClass:"tips text-center"},[i("div",{staticClass:"icon add"}),i("div",{staticClass:"icon number",class:"n"+t.winTipNum.shiWei}),i("div",{directives:[{name:"show",rawName:"v-show",value:void 0!==t.winTipNum,expression:"winTipNum !== undefined"}],staticClass:"icon number",class:"n"+t.winTipNum.geWei})]):t._e()]),i("div",{staticClass:"animate-coins",class:{animate:t.animateCoins}},t._l(6,function(a){return i("div",{staticClass:"icon Coin_icon",class:[{hidden:a>t.maxBullet},"coin"+a]})})),i("div",{staticClass:"button ic_start_game_my",on:{click:function(a){t.$router.push({name:"assets"})}}},[i("span",[t._v(t._s(t.user.assets))])]),i("div",{staticClass:"bullet"},t._l(6,function(a){return i("div",{staticClass:"button ic_start_game_Coin_con",class:{empty:a>t.currentBulletCount}})}))],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"playing"===t.status,expression:"status === 'playing'"}],staticClass:"clock"},[i("div",{staticClass:"button ic_start_game_countdown1"},[i("div",{staticClass:"countdown"},[i("div",{staticClass:"icon number",class:"n"+t.countdown.shiWei}),i("div",{directives:[{name:"show",rawName:"v-show",value:void 0!==t.countdown.geWei,expression:"countdown.geWei !== undefined"}],staticClass:"icon number",class:"n"+t.countdown.geWei})])])]),i("div",{staticClass:"players",class:[t.expand?"expand":"",t.status]},[i("div",{staticClass:"player-queue"},[i("div",{staticClass:"handle",on:{click:function(a){t.expand=!t.expand}}},[t.expand?i("div",{staticClass:"icon ic_arrow_right_icon"}):i("div",{staticClass:"icon ic_arrow_left_icon"}),i("div",{staticClass:"player-count text-center ml5"},[i("div",{staticClass:"icon ic_status_icon_eye_w"}),i("div",{staticClass:"count"},[t._v(t._s(t.playerList.length))])])]),i("transition-group",{staticClass:"player flex",attrs:{name:"slideDownFade",tag:"div"}},t._l(t.playerList,function(a){return i("div",{key:a.name,staticClass:"avatar"},[i("img",{attrs:{src:a.avatar||t.avatarSpare}})])}))],1),i("transition-group",{staticClass:"barrage-list",attrs:{name:"slideDownFade",tag:"div"}},t._l(t.barrageList,function(a){return i("div",{key:a.id,staticClass:"barrage-item"},[i("div",{staticClass:"avatar-sm"},[i("img",{attrs:{src:a.avatar||t.avatarSpare}})]),i("div",{staticClass:"barrage-content"},[t._v(t._s(a.content))])])}))],1),i("div",{staticClass:"live-container"},[i("img",{staticClass:"demo",attrs:{src:n("nTNy")}}),i("div",{staticClass:"bonus-mask"},[i("div",{staticClass:"button ic_start_game_bonus_time",class:"bonusTime"===t.bonusTarget?"animate":""}),i("div",{staticClass:"button ic_start_game_coin",class:"coin"===t.bonusTarget?"animate":""}),i("div",{staticClass:"button ic_start_game_cool",class:"cool"===t.bonusTarget?"animate":""}),i("div",{staticClass:"button ic_start_game_triple_coin",class:"tripleCoin"===t.bonusTarget?"animate":""})])]),i("div",{staticClass:"footer flex"},[i("div",{staticClass:"flex-item"},[i("div",{staticClass:"icon ic_game_Message",on:{click:t.showMessageInput}})]),i("div",{staticClass:"flex-item"},["watching"===t.status?i("div",{staticClass:"button ic_start_game_bg",on:{click:t.beginPlay}},[t._v("ready")]):"playing"===t.status?i("div",{staticClass:"button ic_start_game_bg",on:{click:t.pushCoin}},[t._v("push")]):t._e()]),i("div",{staticClass:"flex-item text-right play-status",on:{click:t.showBonusRandom}},["watching"===t.status?i("div",{staticClass:"button ic_status_icon"},[i("span",[t._v(t._s(t.$t("common.game.statusWatching")))])]):"playing"===t.status?i("div",{staticClass:"button ic_status_icon idle"},[i("span",[t._v(t._s(t.$t("common.game.statusPlaying")))])]):t._e()])]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.messageInputVisible,expression:"messageInputVisible"}],staticClass:"fixed-message"},[i("form",{on:{submit:function(a){a.preventDefault(),t.submit(a)}}},[i("div",{staticClass:"message-input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.message,expression:"message"}],ref:"messageInput",attrs:{type:"text"},domProps:{value:t.message},on:{input:function(a){a.target.composing||(t.message=a.target.value)}}})]),i("button",[t._v("发送")])])])])],1)},staticRenderFns:[]}},nTNy:function(t,a,n){t.exports=n.p+"static/img/home_Show_1@3x.916dfb1.png"},olfr:function(t,a,n){t.exports=n.p+"static/img/push-coin.693d6fb.mp3"},rQQM:function(t,a,n){t.exports=n.p+"static/img/bullet-fill.8c68759.mp3"}});